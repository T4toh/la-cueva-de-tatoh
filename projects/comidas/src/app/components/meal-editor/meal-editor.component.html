<div class="editor-container">
  <h1>{{ mealId ? 'Editar' : 'Nueva' }} Comida</h1>

  <form [formGroup]="form" (ngSubmit)="save()">
    <div class="form-group">
      <label for="name">Nombre</label>
      <input formControlName="name" id="name" placeholder="Ej: Fideos con tuco" type="text">
    </div>

    <div class="form-group">
      <label for="description">Descripción (Opcional)</label>
      <textarea formControlName="description" id="description" rows="3"></textarea>
    </div>

    <div class="form-group checkbox-group">
      <input formControlName="includeInShoppingList" id="includeInShoppingList" type="checkbox">
      <label for="includeInShoppingList">Sumar ingredientes a la lista de compras</label>
    </div>

    <div class="form-group">
      <label for="tag-input">Etiquetas</label>
      <div class="tags-input-container">
        <input id="tag-input" placeholder="Ej: Vegetariano, Rápido" type="text" [formControl]="newTagControl" (keydown.enter)="addTag($event)">
        <button class="btn-secondary" type="button" (click)="addTag()">+</button>
      </div>
      <div class="tags-list">
        @for (tag of tags.controls; track $index) {
          <div class="tag-item">
            <lib-tag [colorFondo]="'var(--color-3)'" [texto]="tag.value" />
            <button class="btn-remove-tag" type="button" (click)="removeTag($index)">×</button>
          </div>
        }
      </div>
    </div>

    <div class="ingredients-section">
      <div class="header">
        <h2>Ingredientes</h2>
        <button class="btn-secondary" type="button" (click)="addIngredient()">+ Agregar</button>
      </div>

      <div formArrayName="ingredients">
        @for (ing of ingredients.controls; track $index) {
          <div class="ingredient-row" [formGroupName]="$index">
            <input formControlName="name" placeholder="Ingrediente (ej: Fideos)" type="text">
            <input formControlName="quantity" placeholder="Cant. (ej: 500g)" type="text">
            <button class="btn-remove" type="button" (click)="removeIngredient($index)">X</button>
          </div>
        }
      </div>
    </div>

    <div class="actions">
      <a class="btn-cancel" routerLink="/meals">Cancelar</a>
      <button class="btn-primary" type="submit" [disabled]="form.invalid">Guardar</button>
    </div>
  </form>
</div>
